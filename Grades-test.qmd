---
title: "grade-test"
author: "DUYCK Louna"
format: html
editor: visual
---

Link of the Github repository : <https://github.com/lounaduyck-afk/grades-test.git>

```{r}
here::i_am("grades-test.Rproj")
library(here)
library(readr)
library(ggplot2)
library(vroom)
library(dplyr)
library(tidyr)
library(lubridate)
library(knitr)
```

# I. Introduction

## 1. Study organisation

### Question 1

```{r}
course <- vroom(
  here("data", "courses.csv"),
  col_types = cols(
    course    = col_character(),
    course_id = col_integer(),
    semester  = col_integer(),
    nb_grades = col_integer()
  )
)
```

### Question 2

```{r}
courses_table <- course |>
  arrange(course) |>
  rename(
    `course name`      = course,
    identifier         = course_id,
    semester           = semester,
    `number of exams`  = nb_grades
  )

courses_table |>
  kable()
```

## 2. Students

```{r}
students <- vroom(
  here("data", "students.csv"),
  col_types = cols(
    id         = col_integer(),
    group      = col_factor(),
    birth_date = col_date(format = ""),
    sex        = col_factor()
  )
)
class(students$birth_date)
class(students$sex)
```

The `birth_date` column of the students data frame is of class Date, and `sex` is a factor.

## 3. Grades

### Question 4

```{r}
grades <- vroom(
  here("data", "grades.csv"),
  delim = "|",
  na = "_",
  col_types = cols(
    id        = col_integer(),
    course_id = col_integer(),
    grade     = col_double()
  )
)
```

# II. Students population analysis

### Question 5

```{r}
ggplot(students, aes(x = group)) +
  geom_bar() +
  labs(x = "Group", y = "Number of students")
```

### Question 6

```{r}
ggplot(students, aes(x = group, fill = sex)) +
  geom_bar(position = "fill") +
  labs(x = "Group", y = "Proportion", fill = "Sex")
```

### Question 7

```{r}
students <- students |>
  mutate(
    age = time_length(today() - birth_date, unit = "year") |> round()
  )

ggplot(students, aes(x = age)) +
  geom_histogram(binwidth = 1, boundary = 0) +
  labs(x = "Age (years)", y = "Number of students")
```

### Question 8

```{r}
median_age_group <- students |>
  summarise(
    median_age = round(median(age)),
    .by = group
  )

median_age_group |>
  arrange(group) |>
  kable()
```

### Question 9

```{r}
oldest_by_group <- students |>
  group_by(group) |>
  filter(age == max(age)) |>
  ungroup() |>
  select(id, group, sex, age) |>
  arrange(desc(age), group, id)

oldest_by_group |>
  kable()
```

# III. Simple grade analysis

### Question 10

```{r}
nb_grades <- grades |>
  summarise(n = sum(!is.na(grade))) |>
  pull(n)
nb_grades
```

The data set contains 53616 grades.

### Question 11

```{r}
astro_id <- course |>
  filter(course == "Astronomy and Cosmology") |>
  pull(course_id)

astro_group <- grades |>
  filter(course_id == astro_id, !is.na(grade)) |>
  inner_join(students, by = "id") |>
  summarise(
    mean_grade = mean(grade),
    .by = group
  )

ggplot(astro_group, aes(x = group, y = mean_grade)) +
  geom_col() +
  labs(
    x = "Group",
    y = "Average grade in Astronomy and Cosmology"
  )
```

### Question 12

```{r}
grades_sem <- grades |>
  filter(!is.na(grade)) |>
  inner_join(course, by = "course_id")

ggplot(grades_sem, aes(x = grade, fill = factor(semester))) +
  geom_density(alpha = 0.4) +
  labs(x = "Grade", fill = "Semester")
```

```{r}
ggplot(grades_sem, aes(x = grade, fill = factor(semester))) +
  geom_boxplot(aes(y = factor(semester))) +
  labs(x = "Grade", fill = "Semester")
```

The grade distribution in the second semester presents a peak around 8-10 while the one in the first semester is around 7. Also the distribution of semester 1 is flatter and more spread out, which suggests more variability in students' performance.

# IV. Attendance analysis

### Question 13

```{r}
grades_students <- grades |>
  filter(!is.na(grade)) |>
  inner_join(students, by = "id")

grades_per_student <- grades_students |>
  summarise(
    n_grades = n(),
    .by = c(id, group, sex)
  )


grades_per_student |>
  slice_head(n = 10) |>
  kable()

grades_summary <- grades_per_student |>
  summarise(
    min    = min(n_grades),
    max    = max(n_grades),
    mean   = mean(n_grades),
    median = median(n_grades)
  )

grades_summary |>
  kable()

```

### Question 14

```{r}
ggplot(grades_per_student, aes(x = n_grades, fill = sex)) +
  geom_histogram(
    position = "dodge",
    binwidth = 1,
    boundary = 0
  ) +
  labs(x = "Number of grades", y = "Number of students", fill = "Sex")

```
