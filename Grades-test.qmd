---
title: "grade-test"
author: "DUYCK Louna"
format: html
editor: visual
---

Link of the Github repository : <https://github.com/lounaduyck-afk/grades-test.git>

```{r}
here::i_am("grades-test.Rproj")
library(here)
library(readr)
library(ggplot2)
library(vroom)
library(dplyr)
library(tidyr)
library(lubridate)
library(knitr)
```

# I. Introduction

## 1. Study organisation

### Question 1

```{r}
course <- vroom(
  here("data", "courses.csv"),
  col_types = cols(
    course    = col_character(),
    course_id = col_integer(),
    semester  = col_integer(),
    nb_grades = col_integer()
  )
)
```

### Question 2

```{r}
courses_table <- course |>
  arrange(course) |>
  rename(
    `course name`      = course,
    identifier         = course_id,
    semester           = semester,
    `number of exams`  = nb_grades
  )

courses_table |>
  kable()
```

## 2. Students

```{r}
students <- vroom(
  here("data", "students.csv"),
  col_types = cols(
    id         = col_integer(),
    group      = col_factor(),
    birth_date = col_date(format = ""),
    sex        = col_factor()
  )
)
class(students$birth_date)
class(students$sex)
```

The `birth_date` column of the students data frame is of class Date, and `sex` is a factor.

## 3. Grades

### Question 4

```{r}
grades <- vroom(
  here("data", "grades.csv"),
  delim = "|",
  na = "_",
  col_types = cols(
    id        = col_integer(),
    course_id = col_integer(),
    grade     = col_double()
  )
)
```

# II. Students population analysis

### Question 5

```{r}
ggplot(students, aes(x = group)) +
  geom_bar() +
  labs(x = "Group", y = "Number of students")
```

### Question 6

```{r}
ggplot(students, aes(x = group, fill = sex)) +
  geom_bar(position = "fill") +
  labs(x = "Group", y = "Proportion", fill = "Sex")
```

### Question 7

```{r}
students <- students |>
  mutate(
    age = time_length(today() - birth_date, unit = "year") |> round()
  )

ggplot(students, aes(x = age)) +
  geom_histogram(binwidth = 1, boundary = 0) +
  labs(x = "Age (years)", y = "Number of students")
```

### Question 8

```{r}
median_age_group <- students |>
  summarise(
    median_age = round(median(age)),
    .by = group
  )

median_age_group |>
  arrange(group) |>
  kable()
```

### Question 9

```{r}
oldest_by_group <- students |>
  group_by(group) |>
  filter(age == max(age)) |>
  ungroup() |>
  select(id, group, sex, age) |>
  arrange(desc(age), group, id)

oldest_by_group |>
  kable()
```

# III. Simple grade analysis

### Question 10

```{r}
nb_grades <- grades |>
  summarise(n = sum(!is.na(grade))) |>
  pull(n)
nb_grades
```

The data set contains 53616 grades.

### Question 11

```{r}
astro_id <- course |>
  filter(course == "Astronomy and Cosmology") |>
  pull(course_id)

astro_group <- grades |>
  filter(course_id == astro_id, !is.na(grade)) |>
  inner_join(students, by = "id") |>
  summarise(
    mean_grade = mean(grade),
    .by = group
  )

ggplot(astro_group, aes(x = group, y = mean_grade)) +
  geom_col() +
  labs(
    x = "Group",
    y = "Average grade in Astronomy and Cosmology"
  )
```

### Question 12

```{r}
grades_sem <- grades |>
  filter(!is.na(grade)) |>
  inner_join(course, by = "course_id")

ggplot(grades_sem, aes(x = grade, fill = factor(semester))) +
  geom_density(alpha = 0.4) +
  labs(x = "Grade", fill = "Semester")
```

```{r}
ggplot(grades_sem, aes(x = grade, fill = factor(semester))) +
  geom_boxplot(aes(y = factor(semester))) +
  labs(x = "Grade", fill = "Semester")
```

The grade distribution in the second semester presents a peak around 8-10 while the one in the first semester is around 7. Also the distribution of semester 1 is flatter and more spread out, which suggests more variability in students' performance.

# IV. Attendance analysis

### Question 13

```{r}
grades_students <- grades |>
  filter(!is.na(grade)) |>
  inner_join(students, by = "id")

grades_per_student <- grades_students |>
  summarise(
    n_grades = n(),
    .by = c(id, group, sex)
  )


grades_per_student |>
  slice_head(n = 10) |>
  kable()

grades_summary <- grades_per_student |>
  summarise(
    min    = min(n_grades),
    max    = max(n_grades),
    mean   = mean(n_grades),
    median = median(n_grades)
  )

grades_summary |>
  kable()

```

### Question 14

```{r}
ggplot(grades_per_student, aes(x = n_grades, fill = sex)) +
  geom_histogram(
    position = "dodge",
    binwidth = 1,
    boundary = 0
  ) +
  labs(x = "Number of grades", y = "Number of students", fill = "Sex")

```

### Question 15

```{r}
hist_id <- course |>
  filter(course == "History and Civilization of Ancient Greece") |>
  pull(course_id)

hist_counts <- students |>
  select(id, group) |>
  left_join(
    grades |>
      filter(course_id == hist_id, !is.na(grade)) |>
      summarise(n_hist = n(), .by = id),
    by = "id"
  ) |>
  mutate(n_hist = replace_na(n_hist, 0L))

hist_counts |>
  slice_head(n = 10) |>
  kable()
```

### Question 16

```{r}
hist_dist <- hist_counts |>
  summarise(
    n_students = n(),
    .by = n_hist
  )

ggplot(hist_dist, aes(x = n_hist, y = n_students)) +
  geom_col() +
  labs(
    x = "Number of History grades",
    y = "Number of students"
  )
```

### Question 17

```{r}
ggplot(hist_counts, aes(x = group, y = n_hist)) +
  geom_boxplot() +
  labs(
    x = "Group",
    y = "Number of History grades"
  )
```

There is no meaningful dependence between the group and the number of History grades and all groups receive approximately the same number of History evaluations.

### Question 18

```{r}
hist_counts_sex <- hist_counts |>
  left_join(students |> select(id, sex), by = "id")

ggplot(hist_counts_sex, aes(x = group, y = n_hist, fill = sex)) +
  geom_boxplot(position = "dodge") +
  labs(
    x = "Group",
    y = "Number of History grades",
    fill = "Sex"
  )
```

There is no significant difference in the number of History grades between male and female students. Both sexes receive almost the same number of assessments, and this pattern is consistent across groups.

# V. Grade analysis

### Question 19

```{r}
avg_per_course <- grades |>
  filter(!is.na(grade)) |>
  summarise(
    mean_grade = mean(grade),
    .by = c(id, course_id)
  ) |>
  inner_join(course, by = "course_id") |>
  inner_join(students |> select(id, group), by = "id")

avg_wide <- avg_per_course |>
  select(id, group, course, mean_grade) |>
  pivot_wider(
    id_cols = c(id, group),
    names_from = course,
    values_from = mean_grade
  )

avg_wide |>
  select(id, group, `Architecture and Sculpture`, `Astronomy and Cosmology`) |>
  slice_head(n = 5) |>
  kable()
```

### Question 20

```{r}
ggplot(
  avg_wide,
  aes(
    x = `Combat and Martial Arts of the Gods`,
    y = `Rhetoric and Persuasion`
  )
) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "lm", se = FALSE, linewidth = 0.8) +
  coord_equal() +
  labs(
    x = "Average grade in Combat and Martial Arts of the Gods",
    y = "Average grade in Rhetoric and Persuasion"
  )
```

We can observe that there is no meaningful linear correlation between performance in Combat and Martial Art of the Gods and performance in Rhetoric and Persuasion. The positive slope suggests a tiny association, but as there is a very large dispersion of the points, we can say that success in one of these two courses does not predict success in the other. Students appear to perform independently in these two courses.

### Question 21

```{r}
corr_by_group <- avg_wide |>
  summarise(
    corr = cor(`Music and Poetry`, `Greek Mythology and Folklore`),
    .by = group
  )

corr_by_group |>
  kable()

ggplot(corr_by_group, aes(x = group, y = corr)) +
  geom_col(fill = "steelblue") +
  geom_hline(yintercept = 0, linetype = "dashed") +
  labs(
    title = "Correlation between Music & Poetry and Greek Mythology & Folklore by Group",
    x = "Group",
    y = "Correlation"
  ) +
  theme_minimal()
```

We observe that the correlation is negative for all groups, meaning that students who perform well in one course tend to perform less well in the other.

### Question 22

```{r}
best_group <- corr_by_group |>
  slice_max(abs(corr), n = 1) |>
  pull(group)

avg_wide |>
  filter(group == best_group) |>
  ggplot(aes(
    x = `Greek Mythology and Folklore`,
    y = `Music and Poetry`
  )) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "lm", se = FALSE, linewidth = 0.8) +
  labs(
    title = paste("Group", best_group),
    x = "Average grade in Greek Mythology and Folklore",
    y = "Average grade in Music and Poetry"
  )
```

For Group 12 (group with the highest correlation coefficient), the inverse relationship between the two courses is strong. It seems like students are divided in two profiles : those wjo excel at mythological and cultural content and those who excel at artistic and creative tasks. In this group, we observe most polarized academic behavior. \

### Question 23

```{r}
course_names <- course$course

final_df <- avg_wide |>
  mutate(
    final_grade = rowMeans(across(all_of(course_names)))
  ) |>
  inner_join(students |> select(id, sex), by = "id") |>
  select(id, group, sex, final_grade) |>
  arrange(desc(final_grade))

final_df |>
  slice_head(n = 5) |>
  kable()
```

### Question 24

```{r}
ggplot(final_df, aes(x = group, y = final_grade)) +
  geom_boxplot() +
  labs(x = "Group", y = "Final grade")
```

The final-grade distribution varies significantly across groups. Some groups (11, 18, 8) perform better, with high medians and low dispersion, while others (15, 5, 20, 9) have lower medians. Variability within groups is generally small, suggesting that students belonging to the same group have similar levels of performance. A few outliers appear, but they do not affect the overall group-level trends.

### Question 25

```{r}
ggplot(final_df, aes(x = group, y = final_grade, fill = sex)) +
  geom_boxplot(position = "dodge") +
  labs(
    x = "Group",
    y = "Final grade",
    fill = "Sex"
  )
```

In this graph, we see that final grades vary across groups, with some groups performing better on average. Male and female students have very similar performance within each group, with no apparent gender advantage. We see that differences between groups are much larger than differences between sexes, so group level factor play a larger role than sex in final grade differences.
