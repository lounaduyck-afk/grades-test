---
title: "grade-test"
author: "DUYCK Louna"
format: html
editor: visual
---

```{r}
here::i_am("grades-test.Rproj")
library(here)
library(readr)
library(ggplot2)
library(vroom)
library(dplyr)
library(tidyr)
library(lubridate)
library(knitr)
```

# I. Introduction

## 1. Study organisation

### Question 1

```{r}
course <- vroom(
  here("data", "courses.csv"),
  col_types = cols(
    course    = col_character(),
    course_id = col_integer(),
    semester  = col_integer(),
    nb_grades = col_integer()
  )
)
```

### Question 2

```{r}
courses_table <- course |>
  arrange(course) |>
  rename(
    `course name`      = course,
    identifier         = course_id,
    semester           = semester,
    `number of exams`  = nb_grades
  )

courses_table |>
  kable()
```

## 2. Students

```{r}
students <- vroom(
  here("data", "students.csv"),
  col_types = cols(
    id         = col_integer(),
    group      = col_factor(),
    birth_date = col_date(format = ""),
    sex        = col_factor()
  )
)
class(students$birth_date)
class(students$sex)
```

The `birth_date` column of the students data frame is of class Date, and `sex` is a factor.

## 3. Grades

### Question 4

```{r}
grades <- vroom(
  here("data", "grades.csv"),
  delim = "|",
  na = "_",
  col_types = cols(
    id        = col_integer(),
    course_id = col_integer(),
    grade     = col_double()
  )
)
```

# II. Students population analysis

### Question 5

```{r}
ggplot(students, aes(x = group)) +
  geom_bar() +
  labs(x = "Group", y = "Number of students")
```

### Question 6

```{r}
ggplot(students, aes(x = group, fill = sex)) +
  geom_bar(position = "fill") +
  labs(x = "Group", y = "Proportion", fill = "Sex")
```

### Question 7

```{r}
students <- students |>
  mutate(
    age = time_length(today() - birth_date, unit = "year") |> round()
  )

ggplot(students, aes(x = age)) +
  geom_histogram(binwidth = 1, boundary = 0) +
  labs(x = "Age (years)", y = "Number of students")
```

### Question 8

```{r}
median_age_group <- students |>
  summarise(
    median_age = round(median(age)),
    .by = group
  )

median_age_group |>
  arrange(group) |>
  kable()
```

### Question 9

```{r}
oldest_by_group <- students |>
  group_by(group) |>
  filter(age == max(age)) |>
  ungroup() |>
  select(id, group, sex, age) |>
  arrange(desc(age), group, id)

oldest_by_group |>
  kable()
```

# III. Simple grade analysis

### Question 10

```{r}
nb_grades <- grades |>
  summarise(n = sum(!is.na(grade))) |>
  pull(n)
nb_grades
```
